---
title: "p8105_hw2_lg3450"
author: Luyun Ge
output: github_document
---

# Problem1
first, clean the data in pols-month.csv
```{r message=FALSE}
library(tidyverse)
```
```{r}
pols_df = 
  # import the data
  read_csv("../fivethirtyeight_datasets/pols-month.csv", na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  # split "mon" into year/month/day in integers
  separate(mon, into = c("year", "month", "day"), sep = "-", convert = TRUE) |>
  # replace month number with month *name*
  mutate(month = month.name[month]) |>
  # create a president variable taking values gop and dem
  mutate(president = case_when(
    prez_gop == 1 ~ "gop",
    prez_dem == 1 ~ "dem"
  )) |>
  # remove prez_dem, prez_gop, day
  select(-prez_dem, -prez_gop, -day) |>
  # keep year and month leading
  relocate(year, month)

View(pols_df)
```
second, clean the data in snp.csv
```{r}
library(lubridate)
```
```{r}
# import the data
snp_df = 
  read_csv("../fivethirtyeight_datasets/snp.csv", na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  # first convert date format into same format yyyy-mm-dd 
  mutate(
    date = coalesce(lubridate::ymd(date), lubridate::mdy(date)),
    # adjust two-digit years
    date = if_else(lubridate::year(date) > 2025, date - lubridate::years(100), date),
    year = lubridate::year(date),
    month_num = lubridate::month(date),
    month = month.name[month_num]
  ) |>  
  arrange(year, month_num, date) |>
  group_by(year, month) |>
  summarise(close = dplyr::last(close), .groups = "drop") |>
  # prioritize year and month
  relocate(year, month)
View(snp_df)
```
third, tidy the unemployment data
```{r}
# import the unemployment data
unemployment_df = 
  read_csv("../fivethirtyeight_datasets/unemployment.csv", na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  # switch from "wide" to "long" format
  pivot_longer(
    cols = -year,               
    names_to = "month",
    values_to = "unemployment_rate"
  ) |>
  mutate(
    month = recode(
      month,
      "jan" = "January", "feb" = "February", "mar" = "March",
      "apr" = "April",   "may" = "May",      "jun" = "June",
      "jul" = "July",    "aug" = "August",   "sep" = "September",
      "oct" = "October", "nov" = "November", "dec" = "December"
    )
  ) |>
  relocate(year, month)
View(unemployment_df)
```
Now join the datasets by merging snp into pols, and merging unemployment into the result.
```{r}
pols_snp_df = 
  left_join(pols_df, snp_df, by = c("year", "month"))
result_df = 
  left_join(pols_snp_df, unemployment_df, by = c("year", "month"))

View(pols_snp_df)
View(result_df)
```
```{r}
names(result_df)
```

* `pols-month.csv`: This dataset contains monthly U.S. political composition. After cleaning, it contains integers for `year` and `month` (as month names), party counts (`gov_gop`, `sen_gop`, `rep_gop`, `gov_dem`, `sen_dem`, `rep_dem`), and `president` variable indicating the presidentâ€™s party that month.

* `snp.csv`: This dataset contains S&P 500 index levels by date. After cleaning, it contains `year`, `month`, and `close`.

* `unemployment.csv`: This dataset contains monthly U.S. unemployment rates in a wide format. I pivoted to a tidy long format with variables `year`, `month` and `unemployment rate`.

* The final merged dataset has `r nrow(result_df)` rows and `r ncol(result_df)` columns, spanning years from 1947 to 2015. Key variables include `year`, `month`, `gov_gop`, `sen_gop`, `rep_gop`, `gov_dem`, `sen_dem`, `rep_dem`, `president`, `close`, and `unemployment rate`.

# Problem2 
Read and clean the Mr. Trash Wheel sheet:
first download the required library
```{r}
library(readxl)
```
then import the data from excel file
```{r}
trash_df = 
  # specify the sheet, omit non-data entries
  read_excel("../202509 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N710") |>
  # clean variable names
  janitor::clean_names() |>
  # omit rows that do not include dumpster-specific data
  drop_na(dumpster) |>
  # round and convert # of sports balls to nearest integer
  mutate(sports_balls = as.integer(round(sports_balls))) |>
  # keep track of wheel type
  mutate(wheel = "mr")

View(trash_df)
```

second clean the ` Professor Trash Wheel` dataset
```{r}
prof_df = 
  # specify the sheet, omit non-data entries
  read_excel("../202509 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", skip = 1) |>
  # clean variable names
  janitor::clean_names() |>
  # omit rows that do not include dumpster-specific data
  drop_na(dumpster) |>
  # keep track of wheel type
  mutate(wheel = "professor")
  
View(prof_df)
```

third clean the `Gwynnda` dataset
```{r}
gwynnda_df = 
  # specify the sheet, omit non-data entries
  read_excel("../202509 Trash Wheel Collection Data.xlsx", sheet = "Gwynns Falls Trash Wheel", skip = 1) |>
  # clean variable names
  janitor::clean_names() |>
  # omit rows that do not include dumpster-specific data
  drop_na(dumpster) |>
  # keep track of wheel type
  mutate(wheel = "gwynnda")
  
View(gwynnda_df)
```

combine 3 datasets
```{r}

```

# Problem3
Create a single, well-organized dataset with all the information contained in these data files. 

To that end: 
import, clean, tidy, and otherwise wrangle each of these datasets; 
check for completeness and correctness across datasets (e.g. by viewing individual datasets and monitoring warning messages); 
merge to create a single, final dataset; 
and organize this so that variables and observations are in meaningful orders.

first we import both datasets
```{r}
zip_codes_df = 
  read_csv("../zillow_data/Zip Codes.csv") |>
  # clean variable names
  janitor::clean_names()

zip_info_df = 
  read_csv("../zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |>
  # clean variable names
  janitor::clean_names()

View(zip_codes_df)
View(zip_info_df)
```











